{
  "hash": "f716b6d7808a143b7dda22df4e552125",
  "result": {
    "engine": "knitr",
    "markdown": "# Asthma and Pollution \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tigris)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nTo enable caching of data, set `options(tigris_use_cache = TRUE)`\nin your R script or .Rprofile.\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(forcats)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ lubridate 1.9.4     ✔ stringr   1.5.1\n✔ purrr     1.1.0     ✔ tibble    3.3.0\n✔ readr     2.1.5     ✔ tidyr     1.3.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(gganimate)\nlibrary(viridis)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: viridisLite\n```\n\n\n:::\n\n```{.r .cell-code}\nedvisits_clean <- readRDS(\"edvisits_clean.rds\")\naqi_ca <- readRDS(\"aqi_ca.rds\")\nhosp_clean <- readRDS(\"hosp_clean.rds\")\ndeaths_expanded <- readRDS(\"deaths_expanded.rds\")\n```\n:::\n\n\n## Emergency Visits & PM2.5\n\n::: {.cell}\n\n```{.r .cell-code}\nedvisits_clean <- edvisits_clean |> \n  mutate(\n    county = tolower(county),\n    year = as.numeric(year)\n  )\n\naqi_ca <- aqi_ca |> \n  mutate(\n    county = tolower(county),\n    year = as.numeric(year)\n  )\n\npm25_year_county <- aqi_ca |>\n  group_by(county, year) |>\n  summarise(\n    pm25_days = mean(days_pm2_5, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nasthma_pm25 <- edvisits_clean |>\n  left_join(pm25_year_county, by = c(\"county\", \"year\"))\n\nglimpse(asthma_pm25)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 406\nColumns: 5\n$ county        <chr> \"alameda\", \"alpine\", \"amador\", \"butte\", \"calaveras\", \"co…\n$ year          <dbl> 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 20…\n$ ed_visits     <dbl> 9939, 0, 196, 1044, 185, 97, 6858, 140, 592, 7936, 122, …\n$ ed_visit_rate <dbl> 64.3, 0.0, 58.4, 50.2, 48.0, 41.4, 65.2, 53.0, 36.4, 77.…\n$ pm25_days     <dbl> 242, 31, 0, 166, 115, 274, 227, 114, 8, 158, 148, 216, 1…\n```\n\n\n:::\n:::\n\n## Scatterplot\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(asthma_pm25, aes(pm25_days, ed_visit_rate)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"lm\", color = \"red\", se = TRUE) +\n  labs(\n    title = \"Relationship Between PM2.5 & Asthma ED Visit Rates\",\n    x = \"PM2.5 Days (Annual Mean)\",\n    y = \"Asthma ED Visit Rate (per 10,000)\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 34 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 34 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor.test(asthma_pm25$pm25_days, asthma_pm25$ed_visit_rate)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  asthma_pm25$pm25_days and asthma_pm25$ed_visit_rate\nt = -1.6776, df = 370, p-value = 0.09426\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n -0.18691451  0.01492413\nsample estimates:\n        cor \n-0.08688677 \n```\n\n\n:::\n:::\n\nA Pearson correlation test was used to assess the linear association between annual PM2.5 pollution days and asthma emergency department visit rates across California counties. The correlation was weak and not statistically significant (r = –0.087, p = 0.094, 95% CI: –0.187 to 0.015), indicating that annual PM2.5 exposure alone does not strongly predict asthma emergency visit rates at the county-year level. This is consistent with the multifactorial nature of asthma exacerbations and the limitations of using aggregated annual PM2.5 days, which may obscure short-term pollution spikes—particularly wildfire smoke episodes—that more directly impact respiratory health.\n\n## Time-Series\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fix county names: title case\nasthma_pm25 <- asthma_pm25 |> \n  mutate(county = stringr::str_to_title(county))\n\n# Fix known truncation issues if needed\nasthma_pm25$county <- recode(\n  asthma_pm25$county,\n  \"An Bernardin\" = \"San Bernardino\",\n  \"An Bernardino\" = \"San Bernardino\",\n  \"Anta Barbar\" = \"Santa Barbara\",\n  \"An Luis Obisp\" = \"San Luis Obispo\"\n)\n\n\nggplot(asthma_pm25, aes(year, ed_visit_rate, group = county)) +\n  geom_line(color = \"#2c7fb8\", linewidth = 0.6) +\n  geom_point(size = 0.9, color = \"black\") +\n  facet_wrap(~ county, scales = \"free_y\") +\n  labs(\n    title = \"Asthma ED Visit Rates Over Time by County\",\n    x = \"Year\",\n    y = \"ED Visit Rate (per 10,000)\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    strip.text = element_text(size = 9, face = \"bold\"),\n    axis.text.x = element_text(size = 7),\n    axis.text.y = element_text(size = 7),\n    panel.grid.minor = element_blank()\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 9 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Faceted County Panels \n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(edvisits_clean, aes(year, ed_visit_rate)) +\n  geom_line(color = \"steelblue\") +\n  facet_wrap(~ county, scales = \"free_y\") +\n  labs(\n    title = \"Asthma ED Visit Rates Over Time by County\",\n    y = \"ED Visit Rate\",\n    x = \"Year\"\n  ) +\n  theme_minimal(base_size = 10)\n```\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## Dual-Line Plot for Individual \n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(asthma_pm25)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 406\nColumns: 5\n$ county        <chr> \"Alameda\", \"Alpine\", \"Amador\", \"Butte\", \"Calaveras\", \"Co…\n$ year          <dbl> 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 20…\n$ ed_visits     <dbl> 9939, 0, 196, 1044, 185, 97, 6858, 140, 592, 7936, 122, …\n$ ed_visit_rate <dbl> 64.3, 0.0, 58.4, 50.2, 48.0, 41.4, 65.2, 53.0, 36.4, 77.…\n$ pm25_days     <dbl> 242, 31, 0, 166, 115, 274, 227, 114, 8, 158, 148, 216, 1…\n```\n\n\n:::\n:::\n\n##Hospitlization Rate and PM2.5\n\n::: {.cell}\n\n```{.r .cell-code}\nasthma_full <- asthma_pm25 |>\n  left_join(hosp_clean, by = c(\"county\", \"year\"))\n\nggplot(asthma_full, aes(pm25_days, hosp_rate)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"lm\", color = \"purple\") +\n  labs(\n    title = \"Relationship Between PM2.5 Days & Asthma Hospitalization Rates\",\n    x = \"PM2.5 Days\",\n    y = \"Hospitalization Rate (per 10,000)\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 106 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 106 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n## Faceted Time Trends \n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(asthma_full, aes(year, hosp_rate)) +\n  geom_line() +\n  facet_wrap(~ county, scales = \"free_y\") +\n  theme_minimal() +\n  labs(\n    title = \"Asthma Hospitalization Rates Over Time by County\",\n    x = \"Year\",\n    y = \"Hospitalization Rate (per 10,000)\"\n  )\n```\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n## Correlation \n\n::: {.cell}\n\n```{.r .cell-code}\ncor.test(asthma_full$pm25_days, asthma_full$hosp_rate)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  asthma_full$pm25_days and asthma_full$hosp_rate\nt = -1.5038, df = 298, p-value = 0.1337\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n -0.19807944  0.02671817\nsample estimates:\n        cor \n-0.08678525 \n```\n\n\n:::\n:::\n\n# Asthma Mortality Rate\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(deaths_expanded)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"county\"                \"year\"                  \"asthma_deaths\"        \n[4] \"asthma_mortality_rate\"\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(GGally)\nlibrary(dplyr)\n\n# Select variables\npcp_data <- asthma_full |>\n  filter(!is.na(pm25_days), !is.na(ed_visit_rate), !is.na(hosp_rate)) |>\n  group_by(county) |>\n  summarise(\n    pm25 = mean(pm25_days, na.rm = TRUE),\n    ed_rate = mean(ed_visit_rate, na.rm = TRUE),\n    hosp_rate = mean(hosp_rate, na.rm = TRUE)\n  )\n\n# Parallel coordinate plot\nGGally::ggparcoord(\n  data = pcp_data,\n  columns = 2:4,        # pm25, ed_rate, hosp_rate\n  groupColumn = 1,      # color by county (optional)\n  scale = \"uniminmax\"\n) +\n  labs(\n    title = \"Parallel Coordinate Plot of Asthma Indicators & PM2.5\",\n    subtitle = \"Each line represents a county\",\n    y = \"Scaled Value\",\n    x = \"Variable\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n## density plot high vs low pollution \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# Create high/low pollution categories\ndensity_data <- asthma_full |>\n  filter(!is.na(pm25_days), !is.na(ed_visit_rate)) |>\n  mutate(\n    pollution_group = ifelse(pm25_days > median(pm25_days, na.rm = TRUE),\n                             \"High PM2.5 Year\",\n                             \"Low PM2.5 Year\")\n  )\n\nggplot(density_data, aes(ed_visit_rate, fill = pollution_group)) +\n  geom_density(alpha = 0.35) +\n  scale_fill_manual(values = c(\"#ef8a62\", \"#67a9cf\")) +\n  labs(\n    title = \"Distribution of Asthma ED Visit Rates in High vs Low PM2.5 Years\",\n    x = \"ED Visit Rate (per 10,000)\",\n    fill = \"Pollution Category\"\n  ) +\n  theme_minimal(base_size = 13)\n```\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(density_data, aes(hosp_rate, fill = pollution_group)) +\n  geom_density(alpha = 0.35) +\n  scale_fill_manual(values = c(\"#998ec3\", \"#f1a340\")) +\n  labs(\n    title = \"Distribution of Asthma Hospitalization Rates in High vs Low PM2.5 Years\",\n    x = \"Hospitalization Rate (per 10,000)\",\n    fill = \"Pollution Category\"\n  ) +\n  theme_minimal(base_size = 13)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 73 rows containing non-finite outside the scale range\n(`stat_density()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-13-2.png){width=672}\n:::\n:::\n\n\n## Ridgeline plot \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggridges)\n\nggplot(asthma_pm25, \n       aes(x = ed_visit_rate, \n           y = factor(year), \n           fill = factor(year))) +\n  geom_density_ridges(alpha = 0.7, scale = 1.2, color = \"white\") +\n  scale_fill_viridis_d(option = \"plasma\") +\n  labs(\n    title = \"Ridgeline Plot of Asthma ED Visit Rates by Year\",\n    x = \"ED Visit Rate (per 10,000)\",\n    y = \"Year\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nPicking joint bandwidth of 5.44\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 9 rows containing non-finite outside the scale range\n(`stat_density_ridges()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(asthma_full, \n       aes(x = hosp_rate, \n           y = factor(year), \n           fill = factor(year))) +\n  geom_density_ridges(alpha = 0.7, scale = 1.2, color = \"white\") +\n  scale_fill_viridis_d(option = \"magma\") +\n  labs(\n    title = \"Ridgeline Plot of Asthma Hospitalization Rates by Year\",\n    x = \"Hospitalization Rate (per 10,000)\",\n    y = \"Year\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nPicking joint bandwidth of 0.497\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 82 rows containing non-finite outside the scale range\n(`stat_density_ridges()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-14-2.png){width=672}\n:::\n:::\n\n\n## wildfires\n\n::: {.cell}\n\n```{.r .cell-code}\nwildfire_years <- c(2017, 2018, 2020)\n\nasthma_wild <- asthma_pm25 |> \n  mutate(\n    pollution_group = ifelse(year %in% wildfire_years,\n                             \"Wildfire Year\",\n                             \"Non-Wildfire Year\")\n  )\n\nggplot(asthma_wild, \n       aes(x = year, y = ed_visit_rate, color = pollution_group)) +\n  geom_line(size = 0.7) +\n  facet_wrap(~ county, scales = \"free_y\") +\n  scale_color_manual(values = c(\"#d95f02\", \"#1b9e77\")) +\n  labs(\n    title = \"Asthma ED Visit Rates: Wildfire vs Non-Wildfire Years\",\n    subtitle = \"Counties showing diverging patterns during major wildfire smoke years\",\n    x = \"Year\",\n    y = \"ED Visit Rate (per 10,000)\",\n    color = \"Pollution Group\"\n  ) +\n  theme_minimal(base_size = 10)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(asthma_full |> left_join(asthma_wild |> select(county, year, pollution_group),\n                                by = c(\"county\", \"year\")),\n       aes(x = year, y = hosp_rate, color = pollution_group)) +\n  geom_line(size = 0.7) +\n  facet_wrap(~ county, scales = \"free_y\") +\n  scale_color_manual(values = c(\"#7570b3\", \"#e7298a\")) +\n  labs(\n    title = \"Asthma Hospitalizations: Wildfire vs Non-Wildfire Years\",\n    x = \"Year\",\n    y = \"Hospitalization Rate (per 10,000)\",\n    color = \"Pollution Group\"\n  ) +\n  theme_minimal(base_size = 10)\n```\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-15-2.png){width=672}\n:::\n:::\n\n\n## biplot \n\n::: {.cell}\n\n```{.r .cell-code}\npca_data <- asthma_pm25 |>\n  select(pm25_days, ed_visit_rate) |>\n  filter(!is.na(pm25_days), !is.na(ed_visit_rate)) |> \n  scale()\n\n\npca <- prcomp(pca_data)\n\nlibrary(ggfortify)\n\nautoplot(\n  pca,\n  data = asthma_pm25 |> filter(!is.na(pm25_days), !is.na(ed_visit_rate)),\n  loadings = TRUE,\n  loadings.label = TRUE,\n  colour = \"county\"\n) +\n  theme_minimal(base_size = 14) +\n  labs(\n    title = \"PCA Biplot: PM2.5 Days & Asthma ED Visit Rates\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `aes_string()` was deprecated in ggplot2 3.0.0.\nℹ Please use tidy evaluation idioms with `aes()`.\nℹ See also `vignette(\"ggplot2-in-packages\")` for more information.\nℹ The deprecated feature was likely used in the ggfortify package.\n  Please report the issue at <https://github.com/sinhrks/ggfortify/issues>.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\npp \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(GGally)\nlibrary(dplyr)\nlibrary(scales)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'scales'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:viridis':\n\n    viridis_pal\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:purrr':\n\n    discard\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:readr':\n\n    col_factor\n```\n\n\n:::\n\n```{.r .cell-code}\npcp_df <- asthma_pm25 |>\n  select(county, pm25_days, ed_visit_rate) |>\n  mutate(across(c(pm25_days, ed_visit_rate), scales::rescale))\n\nggparcoord(\n  data = pcp_df,\n  columns = 2:3,\n  groupColumn = 1,\n  alpha = 0.4,\n  scale = \"uniminmax\"\n) +\n  theme_minimal(base_size = 14) +\n  labs(\n    title = \"Parallel Coordinate Plot: PM2.5 Days & Asthma ED Visit Rates\",\n    subtitle = \"Each line represents a county (values scaled 0–1)\",\n    x = \"Variable\",\n    y = \"Scaled Value\"\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](asthmaxpollution_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [
      "asthmaxpollution_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}